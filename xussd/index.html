
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../sms/">
      
      
        <link rel="next" href="../zcore/">
      
      
      <link rel="icon" href="../assets/Exodus-logo.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.21">
    
    
      
        <title>USSD Service - Software Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ussd-service" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Software Documentation" class="md-header__button md-logo" aria-label="Software Documentation" data-md-component="logo">
      
  <img src="../assets/Exodus-logo-full-1.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Software Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              USSD Service
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  introduction

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../installation/" class="md-tabs__link">
        
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../sms/" class="md-tabs__link">
        
  
    
  
  SMS Service

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  USSD Service

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../zcore/" class="md-tabs__link">
        
  
    
  
  Core Service

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../zeaddmod/" class="md-tabs__link">
        
  
    
  
  Adding A new Service

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Software Documentation" class="md-nav__button md-logo" aria-label="Software Documentation" data-md-component="logo">
      
  <img src="../assets/Exodus-logo-full-1.png" alt="logo">

    </a>
    Software Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SMS Service
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    USSD Service
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    USSD Service
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ussd-lambda" class="md-nav__link">
    <span class="md-ellipsis">
      USSD lambda
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamo-db" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamo DB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#africastalking-ussd-code-callback-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Africastalking USSD Code callback configuration
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../zcore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Service
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../zeaddmod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adding A new Service
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ussd-lambda" class="md-nav__link">
    <span class="md-ellipsis">
      USSD lambda
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamo-db" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamo DB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#africastalking-ussd-code-callback-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Africastalking USSD Code callback configuration
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="ussd-service">USSD Service</h1>
<h3 id="intro">Intro</h3>
<p>This is the service that we use to handle USSD redirection webhooks from <a href="https://africastalking.com/">Africastalking</a> when a user dials our USSD code <code>*7*8*9*6#</code>. The service consists of a USSD lambda (exposes a lambda URL which we configure on our USSD shortcode on the Africastlaking dashboad as our USSD code's callback URL), and a dynamo DB to store USSD sessions and user inputs.</p>
<pre class="mermaid"><code>flowchart TD
A[/Africa's talking\]
F[/USSD Lambda Function\]
D[(Dynamo DB)]
C[\Core service internal API/]

A --&gt; F
F --&gt; D
F --&gt; C
</code></pre>
<pre class="mermaid"><code>sequenceDiagram
  autonumber
  User Phone-&gt;&gt;Telco: User dials USSD short code
  Telco-&gt;&gt;Africas Talking: Send webhook
  Africas Talking-&gt;&gt;USSD Lambda: Send webhook
  USSD Lambda--&gt;&gt;Dynamo DB: Get/Create USSD Session
  Dynamo DB--&gt;&gt;USSD Lambda: Get/Create USSD Session Response
  USSD Lambda--&gt;&gt;Core service internal API: Get Data
  USSD Lambda--&gt;&gt;Dynamo DB: Store data on USSD Session
  USSD Lambda-&gt;&gt;Africas Talking: Webhook response
  Africas Talking-&gt;&gt;Telco: Webhook Response
  Telco-&gt;&gt;User Phone: Render USSD menu</code></pre>
<h3 id="ussd-lambda">USSD lambda</h3>
<p>The USSD Lambda is an <a href="https://aws.amazon.com/pm/lambda/">AWS lambda function</a> named <code>ussd-lambda</code> deployed in AWS region <code>me-south-1</code>. The lambda function definition is done in terraform and the files are found in <a href="https://github.com/Exodus-Mobility/dw-backend/tree/main/terraform/ussd/lambda">/terraform/ussd/lambda/*</a>. The functions dependencies are bundled into lambda layers which the function uses. The lambda layer terraform definition is found in <a href="https://github.com/Exodus-Mobility/dw-backend/tree/main/terraform/ussd/layers">/terraform/ussd/layers/*</a>. The function source code is written in Javascript and it is found in <a href="https://github.com/Exodus-Mobility/dw-backend/tree/main/ussd">/ussd/*</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To update the function raise a PR with your changes on either terraform or the source code, when you merge the code the changes will be auto deployed.</p>
</div>
<h3 id="dynamo-db">Dynamo DB</h3>
<p>The USSD Dynamodb is an <a href="https://aws.amazon.com/pm/dynamodb/">AWS Amazon DynamoDB table</a> named <code>ussd-sessions</code> deployed in aws region <code>me-south-1</code>. The Dynamodb definition was done via terraform and files are found in <a href="https://github.com/Exodus-Mobility/dw-backend/tree/main/terraform/data_stores/dynamodb">/terraform/data_stores/dynamodb/*</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To update the Dynamodb table or it's properties update the queue's terraform files with the properties you want and apply the terrafom changes using <code>terraform apply</code></p>
</div>
<h3 id="africastalking-ussd-code-callback-configuration">Africastalking USSD Code callback configuration</h3>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Updating the callback URL will casue your USSD service to have downtime if you configure it to an invalid URL(URL that is not the USSSD lambda URL) We suggest that you backup the existing value so that you can rollback if you make a mistake.</p>
</div>
<ul>
<li>On the Africastalking dashboad click USSD then select Service Codes. </li>
</ul>
<p><img alt="image" src="../assets/images/africastalking_dashboad_ussd.png" /></p>
<ul>
<li>On the list of the service Codes that apper click the  humbager on the srervice code that you want to update and select callback.</li>
</ul>
<p><img alt="image" src="../assets/images/africastalking_dashboad_ussd_callback.png" /></p>
<ul>
<li>On pop up menu that appers update the callback URL with the new URL or your lambda if you are changeing the service to pint to a new lambda or USSD service.</li>
</ul>
<p><img alt="image" src="../assets/images/africastalking_dashboad_callback_popup.png" />
-  click save to save and exit.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../sms/" class="md-footer__link md-footer__link--prev" aria-label="Previous: SMS Service">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                SMS Service
              </div>
            </div>
          </a>
        
        
          
          <a href="../zcore/" class="md-footer__link md-footer__link--next" aria-label="Next: Core Service">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Core Service
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "content.tabs.link", "content.code.copy", "content.code.annotate", "navigation.footer"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a7c05c9e.min.js"></script>
      
    
  </body>
</html>